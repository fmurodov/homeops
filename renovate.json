{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "docker:enableMajor",
    "customManagers:dockerfileVersions",
    "customManagers:githubActionsVersions",
    ":disableRateLimiting",
    ":dependencyDashboard",
    ":semanticCommits",
    ":enablePreCommit",
    ":separateMultipleMajorReleases",
    ":ignoreModulesAndTests",
    ":maintainLockFilesWeekly"
  ],
  "dependencyDashboardTitle": "Renovate Dashboard ðŸ¤–",
  "labels": ["dependencies", "automated"],
  "separateMinorPatch": true,
  "prHourlyLimit": 4,
  "prConcurrentLimit": 16,
  "timezone": "UTC",
  "rangeStrategy": "pin",
  "lockFileMaintenance": {
    "extends": ["config:recommended"],
    "packageRules": [
      {
        "matchUpdateTypes": ["pin", "digest"],
        "automerge": false
      }
    ]
  },
  "flux": {
    "managerFilePatterns": ["/\\.ya?ml$/"],
    "rangeStrategy": "replace"
  },
  "helm-values": {
    "managerFilePatterns": ["/\\.ya?ml$/"],
    "rangeStrategy": "replace"
  },
  "kubernetes": {
    "managerFilePatterns": ["/\\.ya?ml$/"],
    "rangeStrategy": "replace"
  },
  "kustomize": {
    "enabled": true,
    "managerFilePatterns": ["/kustomization\\.ya?ml$/"],
    "rangeStrategy": "replace"
  },
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["/\\.ya?ml$/"],
      "matchStrings": [
        "registryUrl=(?<registryUrl>.*?)\n *tag: (?<currentValue>.*)\n"
      ],
      "depNameTemplate": "{{{registryUrl}}}",
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Match Talos factory installer images with version tags in YAML files",
      "managerFilePatterns": ["/\\.ya?ml$/"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\n\\s+image: factory\\.talos\\.dev/installer/[a-f0-9]+:(?<currentValue>v\\S+)"
      ],
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "description": "Match Talos factory installer images with version tags in Markdown files",
      "managerFilePatterns": ["/\\.md$/"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\n.*factory\\.talos\\.dev/installer/[a-f0-9]+:(?<currentValue>v\\S+)"
      ],
      "datasourceTemplate": "github-releases"
    },

    {
      "customType": "regex",
      "managerFilePatterns": ["/\\.ya?ml$/"],
      "matchStrings": [
        "chart:\n *repository: (?<registryUrl>.*?)\n *name: (?<depName>.*?)\n *version: (?<currentValue>.*)\n"
      ],
      "datasourceTemplate": "helm"
    }
  ],
  "packageRules": [
    {
      "description": "Disable built-in managers for Talos factory installer images",
      "matchFileNames": ["talos/**/*.yaml"],
      "matchPackageNames": ["factory.talos.dev/installer/**"],
      "enabled": false
    },
    {
      "description": "Mark Docker and Helm updates as high priority",
      "matchDatasources": ["docker", "helm"],
      "labels": ["priority-high", "infrastructure"]
    },
    {
      "description": "Add custom labels for Flux-managed updates",
      "matchFileNames": [
        "kubernetes/clusters/**/*.yaml",
        "kubernetes/apps/**/*.yaml",
        "kubernetes/infrastructure/**/*.yaml"
      ],
      "labels": ["flux", "k8s"]
    },
    {
      "description": "Add labels for Talos updates",
      "matchFileNames": ["talos/**/*.yaml"],
      "labels": ["talos", "infrastructure"]
    },
    {
      "description": "Handle major version updates separately",
      "matchUpdateTypes": ["major"],
      "labels": ["major-update", "needs-review"]
    },
    {
      "description": "Automerge Minecraft Bedrock updates without waiting",
      "matchPackageNames": [
        "LomotHo/minecraft-bedrock",
        "itzg/minecraft-bedrock-server"
      ],
      "automerge": true,
      "minimumReleaseAge": null,
      "labels": ["minecraft", "automerge"]
    }
  ],
  "ignorePaths": [
    "**/node_modules/**",
    "**/bower_components/**",
    "**/charts/*/charts/**",
    "**/temp/**",
    "**/vendor/**",
    "**/dist/**",
    "**/build/**"
  ],
  "commitBody": "Signed-off-by: Renovate Bot <bot@renovateapp.com>",
  "prBodyTemplate": "{{{header}}}{{{table}}}{{{warnings}}}{{{notes}}}{{{changelogs}}}{{{controls}}}{{{footer}}}",
  "rebaseLabel": "rebase",
  "rebaseWhen": "behind-base-branch",
  "prNotPendingHours": 72,
  "prCreation": "not-pending",
  "pruneStaleBranches": true,
  "pruneBranchAfterAutomerge": true
}
